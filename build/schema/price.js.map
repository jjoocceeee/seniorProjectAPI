{"version":3,"sources":["../../src/schema/price.js"],"names":["_","require","addDays","differenceInDays","priceSchema","mongoose","Schema","openPrice","type","Number","description","required","closePrice","volume","date","Date","ticker","String","index","Price","model","customizationOptions","PriceTC","addResolver","name","args","resolve","source","context","CheckTwentyDay","highCheck","indexDate","twentyDayHighDate","twenty","checkPullBack","highPrice","prevhigh","number","amount","pullbackDate","find","$lte","$gt","prices","high","check","forEach","price","twentyBefore","highPriceDate","highDate"],"mappings":"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","sourcesContent":["import { composeWithMongoose } from 'graphql-compose-mongoose/node8';\r\nimport mongoose, { mongo } from 'mongoose';\r\n\r\nvar _ = require('lodash');\r\nvar addDays = require('date-fns/addDays');\r\nvar differenceInDays = require('date-fns/differenceInDays')\r\n\r\nconst priceSchema = new mongoose.Schema({\r\n  openPrice: {\r\n    type: Number,\r\n    description: \"Opening Price of Stock.\",\r\n    required: true\r\n  }, \r\n  closePrice: {\r\n    type: Number,\r\n    description: \"Closing Price of Stock.\",\r\n    required: true\r\n  }, \r\n  volume: {\r\n    type: Number,\r\n    description: \"Volume of Stocks sold that day.\",\r\n    required: true\r\n  }, \r\n  date: {\r\n    type: Date,\r\n    description: \"Date-Time for this price.\",\r\n    required: true\r\n  },\r\n  ticker: {\r\n    type: String,\r\n    description: \"Stock this price is associated with.\",\r\n    required: true,\r\n    index:true\r\n  }\r\n});\r\n\r\nconst Price = mongoose.model('Price', priceSchema);\r\nconst customizationOptions = {};\r\nconst PriceTC = composeWithMongoose(Price, customizationOptions);\r\n\r\nPriceTC.addResolver({\r\n  name: \"checkTwentyDayHigh\",\r\n  type: \"Boolean\",\r\n  args: {\r\n    date: \"Date!\",\r\n    ticker: \"String!\"\r\n  },\r\n  resolve: async ({args, source, context}) => {\r\n    return await CheckTwentyDay(args.date).highCheck\r\n  }\r\n})\r\n\r\nPriceTC.addResolver({\r\n  name: \"fourCandleHammer\",\r\n  type: \"Boolean\",\r\n  args: {\r\n    date: \"Date!\",\r\n    ticker: \"String!\",\r\n  },\r\n  resolve: async ({args, source, context}) => {\r\n      let indexDate = new Date(args.date);\r\n      let twentyDayHighDate = new Date(addDays(indexDate, -24));\r\n      let twenty = await CheckTwentyDay(twentyDayHighDate);\r\n      if(twenty.highCheck){\r\n        //Check for a pullback.\r\n        return await checkPullBack(twenty.highPrice, -4, indexDate, args.ticker);\r\n      }\r\n  }\r\n});\r\n\r\n\r\n/*\r\n * Check if there was a 20 day high followed by a 4 day pullback.\r\n * This method is commonly referred to as the Four Candle Hammer Algorithm.\r\n * Parameters:        prevhigh  =>  High $ to check to pullback against.\r\n *                    number    =>  number of days to check for a pullback. Default is 4.\r\n *                    date      =>  Date to check the four candle hammer around (will often be today).\r\n *                    ticker    =>  Ticker symbol for the stock.\r\n *\r\n */\r\nasync function checkPullBack(prevhigh, number, date, ticker){\r\n  let amount = number || -4;\r\n  let indexDate = new Date(date);\r\n  let pullbackDate = new Date(addDays(indexDate, amount));\r\n  let prices = await Price.find({\r\n    'date':{\r\n      $lte:indexDate,\r\n      $gt:pullbackDate\r\n    },\r\n    'ticker':ticker\r\n  });\r\n  let high = prevhigh;\r\n  let check = true;\r\n  _.forEach(prices, price => {\r\n    if(price.openPrice > high){\r\n      check = false;\r\n    }\r\n  });\r\n  return check;\r\n}\r\n\r\n\r\n\r\nasync function CheckTwentyDay(date, ticker){\r\n  let indexDate = new Date(date);\r\n  let twentyBefore = new Date(addDays(indexDate, -20));\r\n  let prices = await Price.find({\r\n    'date':{\r\n      $lte:indexDate,\r\n      $gt:twentyBefore\r\n    },\r\n    'ticker':ticker\r\n  });\r\n\r\n  let high = 0.0;\r\n  let highPriceDate = indexDate;\r\n  _.forEach(prices, price => {\r\n    if(price.closePrice > high){\r\n      high = price.closePrice;\r\n      highPriceDate = price.date\r\n    }\r\n  });\r\n  if(differenceInDays(indexDate, highPriceDate) == 0){\r\n    return {\r\n      highCheck:true,\r\n      highDate: highPriceDate,\r\n      highPrice:high\r\n    }\r\n  } else {\r\n    return {\r\n      highCheck:false,\r\n      highDate: highPriceDate,\r\n      highPrice:high\r\n    }\r\n  }\r\n}\r\n\r\nexport { PriceTC };"],"file":"price.js"}